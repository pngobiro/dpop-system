{% extends "layouts/base.html" %}

{% block title %} Statistics Dashboard {% endblock %}

{% block content %}
<div unicorn:view> {# Keep the unicorn view wrapper #}
    <div class="container-fluid mt-4">
        <h1 class="h3 mb-4" style="color: #006633;">Statistics Dashboard</h1> {# Judiciary Green #}

        {# Row 1: Summary Cards - REMOVED #}

        {# Row 2: Selection Form and Top Case Types #}
        <div class="row">
            {# Column 1: Selection Form - Make full width #}
            <div class="col-12 mb-4"> {# Changed from col-lg-6 #}
                <div class="card shadow-sm border-light">
                    <div class="card-header py-3 bg-light">
                        <h6 class="m-0 font-weight-bold" style="color: #006633;">Select Criteria for Unit View</h6> {# Judiciary Green #}
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">Select court rank, financial year, and quarter to view detailed unit statistics.</p>
                        <div class="form-group mb-3">
                            <label for="court_rank" class="form-label">Unit Rank</label>
                            <select class="form-select" id="court_rank" name="court_rank" unicorn:change="changeCourtRank" unicorn:model="court_rank">
                                <option value="">Select Unit Rank</option>
                                {% for unit_rank in unit_ranks %}
                                    <option value="{{ unit_rank.id }}">{{ unit_rank.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label for="financial_year" class="form-label">Financial Year</label>
                            <select class="form-select" id="financial_year" name="financial_year" unicorn:change="changeFinancialYear" unicorn:model="financial_year" unicorn:disabled="!court_rank">
                                <option value="">Select Financial Year</option>
                                {% for financial_year in financial_years %} {# Assuming this context exists #}
                                    <option value="{{ financial_year.id }}">{{ financial_year.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label for="quarter" class="form-label">FY Quarter</label>
                            <select class="form-select" id="quarter" name="quarter" unicorn:model="quarter" unicorn:change="changeQuarter" unicorn:disabled="!financial_year">
                                <option value="">Select Quarter</option>
                                {% for quarter in financial_quarters %} {# Assuming this context exists #}
                                    <option value="{{ quarter.id }}">{{ quarter.get_quarter_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {# Button to navigate, enabled only when all selections are made #}
                        <div class="mt-3 text-end">
                             <a id="viewUnitsBtn"
                                href="#" {# URL will be set by JS #}
                                class="btn btn-primary disabled" {# Start disabled #}
                                role="button"
                                aria-disabled="true"
                                >
                                 View Units
                             </a>
                        </div>
                    </div>
                </div>
            </div>
            {# Column 2: Top Case Types - REMOVED #}
        </div>

        {# Row 3: New Functionality Cards #}
        <div class="row">
             {# Reports Card #}
            <div class="col-lg-4 mb-4">
                <div class="card shadow-sm border-light h-100">
                    <div class="card-header py-3 bg-light">
                        <h6 class="m-0 font-weight-bold" style="color: #006633;"><i class="fas fa-chart-pie me-2"></i> Reports</h6> {# Judiciary Green #}
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">Generate and view periodic and ad hoc reports.</p>
                        <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action">Quarterly Reports</a> {# Placeholder Link #}
                            <a href="#" class="list-group-item list-group-item-action">Half-Year Reports</a> {# Placeholder Link #}
                            <a href="#" class="list-group-item list-group-item-action">Annual Reports</a> {# Placeholder Link #}
                            <a href="#" class="list-group-item list-group-item-action">Ad Hoc Reports</a> {# Placeholder Link #}
                        </div>
                    </div>
                </div>
            </div>
             {# Data Management Card #}
            <div class="col-lg-4 mb-4">
                <div class="card shadow-sm border-light h-100">
                    <div class="card-header py-3 bg-light">
                        <h6 class="m-0 font-weight-bold" style="color: #006633;"><i class="fas fa-upload me-2"></i> Data Management</h6> {# Judiciary Green #}
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">Upload and manage monthly statistical data.</p>
                         <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action">Upload Monthly Data</a> {# Placeholder Link #}
                            <a href="#" class="list-group-item list-group-item-action">View Upload History</a> {# Placeholder Link #}
                            <a href="#" class="list-group-item list-group-item-action">Data Quality Checks</a> {# Placeholder Link #}
                        </div>
                    </div>
                </div>
            </div>
             {# Analysis Card #}
            <div class="col-lg-4 mb-4">
                <div class="card shadow-sm border-light h-100">
                    <div class="card-header py-3 bg-light">
                        <h6 class="m-0 font-weight-bold" style="color: #006633;"><i class="fas fa-search-chart me-2"></i> Analysis Tools</h6> {# Judiciary Green #}
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">Explore data trends and perform analysis.</p>
                         <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action">Trend Analysis</a> {# Placeholder Link #}
                            <a href="#" class="list-group-item list-group-item-action">Comparative Analysis</a> {# Placeholder Link #}
                            <a href="#" class="list-group-item list-group-item-action">Custom Analysis</a> {# Placeholder Link #}
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div> {# End unicorn:view #}
{% endblock content %}

{% block javascripts %}
{{ block.super }} {# Include parent block scripts if any #}
<script>
    function updateViewUnitsButton() {
        const rankSelect = document.getElementById('court_rank');
        const yearSelect = document.getElementById('financial_year');
        const quarterSelect = document.getElementById('quarter');
        const viewBtn = document.getElementById('viewUnitsBtn');

        if (!rankSelect || !yearSelect || !quarterSelect || !viewBtn) {
            // console.error("Required elements not found for button update."); // Optional: for debugging
            return;
        }

        const rankId = rankSelect.value;
        const yearId = yearSelect.value;
        const quarterId = quarterSelect.value;

        // Check if all dropdowns have a non-empty value selected
        if (rankId && yearId && quarterId) {
            // Construct the URL using the selected IDs
            // IMPORTANT: This assumes the URL name 'statistics:rank_units' exists and
            // matches the pattern defined in apps/statistics/urls.py.
            // A safer approach in complex apps might be to pass the base URL pattern
            // from the Django view to a JS variable.
            const url = `/statistics/rank/${rankId}/fy/${yearId}/fq/${quarterId}/units`; // Construct URL manually
            viewBtn.href = url;
            viewBtn.classList.remove('disabled');
            viewBtn.removeAttribute('aria-disabled');
        } else {
            // Disable button if any selection is missing
            viewBtn.href = "#"; // Prevent navigation
            viewBtn.classList.add('disabled');
            viewBtn.setAttribute('aria-disabled', 'true');
        }
    }

    // Add event listeners to dropdowns when the DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        const rankSelect = document.getElementById('court_rank');
        const yearSelect = document.getElementById('financial_year');
        const quarterSelect = document.getElementById('quarter');

        if (rankSelect) rankSelect.addEventListener('change', updateViewUnitsButton);
        if (yearSelect) yearSelect.addEventListener('change', updateViewUnitsButton);
        if (quarterSelect) quarterSelect.addEventListener('change', updateViewUnitsButton);

        // Initial check in case the page loads with selections already made (e.g., browser back button)
        updateViewUnitsButton();
    });
</script>
{% endblock javascripts %}
